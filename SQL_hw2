#ИЗМЕНЕНИЕ ТАБЛИЦЫ СТРАН--------------------------

USE `lesson1`;
ALTER TABLE `countries`
CHANGE COLUMN `name` `title` VARCHAR(150) NOT NULL;

ALTER TABLE `countries`
MODIFY `id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY;
CREATE INDEX `countries_index` ON `countries`(`title`);

#ИЗМЕНЕНИЕ ТАБЛИЦЫ РЕГИОНОВ--------------------------
ALTER TABLE `states`
RENAME TO `regions`,
MODIFY `id` INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
CHANGE COLUMN `id_country` `country_id` INT NOT NULL,
ADD CONSTRAINT `reg_country` FOREIGN KEY (`country_id`)
REFERENCES `countries`(`id`)
ON UPDATE CASCADE
ON DELETE RESTRICT,
CHANGE COLUMN `state_name` `title` VARCHAR(150) NOT NULL;

CREATE INDEX `regions_index` ON `regions`(`title`);

#ИЗМЕНЕНИЕ ТАБЛИЦЫ ГОРОДОВ--------------------------
ALTER TABLE `cities`
MODIFY `id` INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
ADD COLUMN `country_id` INT NOT NULL AFTER `id`,
ADD COLUMN `important` TINYINT(1) NOT NULL AFTER `country_id`,
CHANGE COLUMN `id_state` `region_id` INT NOT NULL,
ADD CONSTRAINT `cit_regions` FOREIGN KEY (`region_id`)
REFERENCES `regions`(`id`)
ON UPDATE CASCADE
ON DELETE RESTRICT,
CHANGE COLUMN `city_name` `title` VARCHAR(150) NOT NULL;

CREATE INDEX `cities_index` ON `cities`(`title`);


SET FOREIGN_KEY_CHECKS=0;
#ИСПОЛЬЗОВАЛ ДАННУЮ КОМАНДУ ЧТОБЫ УБРАТЬ ОШИБКУ Error Code: 1452. Cannot add or update a child row: a foreign key constraint fails

ALTER TABLE `cities`
ADD CONSTRAINT `cit_country` FOREIGN KEY (`country_id`)
REFERENCES `countries`(`id`)
ON UPDATE CASCADE
ON DELETE RESTRICT;
